# Energy Monitor

## Description
#### A dashboard for the monitoring of energy metrics and such as price, demand, or carbon production. See how much of your electricity is generated by nuclear fission, check the cheapest time to charge your electric campervan, or just have a curious glance at what's going on in the grid we all depend upon.

## Requirements
- MacOS
- Python 3.12
- Amazon AWS  ([with an access key and secret key](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html))
- [Brew](https://brew.sh/) (to install Terraform)
- (Terraform)[https://formulae.brew.sh/formula/terraform]
- [Docker](https://docs.docker.com/desktop/install/mac-install/)

- For badges and reports to be generated you will also need a [CodeCov](https://about.codecov.io/) and [CodeClimate](https://codeclimate.com/) account. These are free and will need to be linked to your own git repo using their respective browser-based GUIs.

## 'Visuals'
! We'll add some visuals here maybe, using [Asciinema](https://asciinema.org/) or using [ttygif](https://github.com/icholy/ttygif) and a recording. !

## Badges

<div align="center">

![GitHub Stars](https://img.shields.io/github/stars/JoshuaMarden/energy_monitor.svg?style=social&label=Star) ![GitHub Contributors](https://img.shields.io/github/contributors/JoshuaMarden/energy_monitor) ![GitHub Last Commit](https://img.shields.io/github/last-commit/JoshuaMarden/energy_monitor)<br>
[![Unittests](https://github.com/JoshuaMarden/energy_monitor/actions/workflows/unittests.yml/badge.svg)](https://github.com/JoshuaMarden/energy_monitor/actions/workflows/unittests.yml) [![Deploy to Cloud](https://github.com/JoshuaMarden/energy_monitor/actions/workflows/test_build_push.yml/badge.svg)](https://github.com/JoshuaMarden/energy_monitor/actions/workflows/test_build_push.yml)<br>
[![codecov](https://codecov.io/github/JoshuaMarden/energy_monitor/graph/badge.svg?token=5CLXJXIEE8)](https://codecov.io/github/JoshuaMarden/energy_monitor) [![Maintainability](https://api.codeclimate.com/v1/badges/2b5506b2c460c017238e/maintainability)](https://codeclimate.com/github/JoshuaMarden/energy_monitor/maintainability) [![Test Coverage](https://api.codeclimate.com/v1/badges/2b5506b2c460c017238e/test_coverage)](https://codeclimate.com/github/JoshuaMarden/energy_monitor/test_coverage)<br>
![License](https://img.shields.io/github/license/JoshuaMarden/energy_monitor)

</div>



## Installation
[Clone the repo](https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository) from github.

In terminal, navigate to the root directory of the repository `energy_monitor`.
Run the following commands:
- `python3 -m venv .venv`
- `bash setup.sh` ! we might want a simple setup script !
- `source .venv/bin/activate`
- `add_root_to_path.sh`
- `pip3 install requirements.txt`

You then need to setup files containing your personal secrets.
Create a `.env` file in the root directory with the following:
```
AWS_ACCESS_KEY=myaccesskey
AWS_SECRET_KEY=mysecretkey
AWS_REGION="my-region-#"
```
Create a `terraform.tfvars` file in the root directory with the following:
```
AWS_REGION = "my-region-#"
AWS_ACCESS_KEY = "myaccesskey"
AWS_SECRET_KEY = "mysecretkey"
DB_HOST = "energy-monitor.????????.my-region-#.rds.amazonaws.com"
DB_PORT = "5432"
DB_PASSWORD = "mypassword"
DB_USER = "myusername"
DB_NAME = "mydatabasename"
```
To then build the infrastructure navigate into `infrastructure/` run `terraform plan` then `terraform apply`.

Once you have done this, you should be able to deploy the modules to the cloud using `bash build_and_push.sh`.

For workflows (used by tests and badges) to run you will need to add to your repo's secrets. There are found in the repo's settings, first select 'Secrets and variables'. Under 'actions', 'secrets' select 'New repository secrets'. Add the following:

- AWS_ACCESS_KEY (as above)
- AWS_REGION (as above)
- AWS_SECRET_KEY (as above)
- ECR_URL (the URL to your AWS Elastic Container Registry)
- CODECOV_TOKEN (From the CodeCov website once you have created an account)
- CC_TEST_REPORTER_ID (From the CodeClimate website once you have created an account)

The names must match perfectly as the code is configured to search for these exact names.

## Data Sources & Design Choices

Energy production, demand, and cost data is sources from [Elexions](https://bmrs.elexon.co.uk/remit). Carbon tracking data is taken from [carbon_intensity.org](https://api.carbonintensity.org.uk/). 

Our Extract, Transform, Load [ETL] pipleine works in the following way; firstly, **E**xtract scripts for each API endpoint run regularly on Amazon Web Service [AWS] Lambdas requesting the latest data. Lambdas are quick to fire up and shut down, making them the ideal choice to quickly execute lightweight, intermittent tasks. This fresh data is then transferred to an AWS 's3 bucket', offering a quick and cost-effective storage. Some modest data curation is done by a **T**ransform script, and a **L**oad script loads the clean data into a PostGres SQL database on the AWS. For a full-scale and not a proof-of-concept project, we would ideally use an Amazon RedShift database which better supports read-heavy operations. In our limited instance, the inexpensive PostGres database is the best solution.

Another script runs our [StreamLit](https://streamlit.io) dashboard. StreamLit is an open-source dashboard solution that is easy to work with and lightweight to run. The dashboard, running perpetually as a service on an EC2 instance, reads data from our database and plots it in a pleasing set of graphs.

## Road Map

Where could we go next?

- Automatic location detection
- Switch to RedShift
- Tariffs of ‘big 6’ energy suppliers (Price Comparison)
- News feed of energy-relevant articles
- Smart meter integration

Elexon offers a lot more data that we could integrate, and energy suppliers like Octopus offer detailed insight which might allow users to add their personal energy usage to the dashboard.

## Support

If you are having trouble using our app please open a ticket we'll get back to you as soon as possible. 

## Authors and Acknowledgment

If people have pushed to this repo, they are authors.

## License

[Elexon License](https://www.elexon.co.uk/data/balancing-mechanism-reporting-agent/copyright-licence-bmrs-data/) requires the following statement: 

Contains BMRS data © Exelon Limited copyright and database right 2024.

MIT License

Copyright (c) 2024 J J Marden

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

## Testing Coverage Visualised ([CodeCov](https://app.codecov.io/gh/JoshuaMarden/energy_monitor?token=5CLXJXIEE8))

<div align="center">

![Coverage Sunburst](https://codecov.io/github/JoshuaMarden/energy_monitor/graphs/sunburst.svg?token=5CLXJXIEE8)
![Codecov Tree Map](https://codecov.io/github/JoshuaMarden/energy_monitor/graphs/tree.svg?token=5CLXJXIEE8)<br>
![Codecov Icicle Chart](https://codecov.io/github/JoshuaMarden/energy_monitor/graphs/icicle.svg?token=5CLXJXIEE8)


</div>
<div align="center">
(If this is not displaying it is because it has not yet collected enough data to build a 'Coverage Over Time' graph)
![Coverage Over Time](https://codecov.io/gh/JoshuaMarden/energy_monitor/graphs/commits.svg?token=5CLXJXIEE8)
</div>
